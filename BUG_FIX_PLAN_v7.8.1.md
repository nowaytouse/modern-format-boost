# BUGä¿®å¤è®¡åˆ’ v7.8.1

åŸºäºæ·±åº¦æ—¥å¿—åˆ†æï¼Œå‘ç°ä»¥ä¸‹éœ€è¦ä¿®å¤çš„BUGå’Œæ”¹è¿›ç‚¹ï¼š

## ğŸ” åˆ†æç»“æœæ€»ç»“

- **æ€»å¤„ç†æ–‡ä»¶**: 2545ä¸ª (2541å›¾ç‰‡ + 4è§†é¢‘)
- **æˆåŠŸè½¬æ¢**: 22æ¬¡ (æˆåŠŸç‡æä½ < 1%)
- **ä¸»è¦é—®é¢˜**: GIFåƒç´ æ ¼å¼ä¸å…¼å®¹å¯¼è‡´è´¨é‡è®¡ç®—å¤±è´¥

## ğŸ› å‘ç°çš„BUG

### 1. GIFåƒç´ æ ¼å¼ä¸å…¼å®¹ (ä¸¥é‡) - 47æ¬¡
**é—®é¢˜**: GIFæ–‡ä»¶çš„bgraåƒç´ æ ¼å¼ä¸MS-SSIMè®¡ç®—ä¸å…¼å®¹
**å½±å“**: å¯¼è‡´è´¨é‡éªŒè¯å¤±è´¥ï¼Œå¤§é‡æ–‡ä»¶è¢«è·³è¿‡
**çŠ¶æ€**: âœ… å·²ä¿®å¤ (v7.8ä¸­å·²æ·»åŠ GIFæ£€æµ‹)

### 2. MS-SSIMè®¡ç®—å®Œå…¨å¤±è´¥ (ä¸¥é‡) - 13æ¬¡  
**é—®é¢˜**: libvmafä¸å¯ç”¨æˆ–åƒç´ æ ¼å¼ä¸å…¼å®¹
**å½±å“**: è´¨é‡éªŒè¯fallbackåˆ°å•é€šé“ï¼Œå¯èƒ½ä¸å‡†ç¡®
**çŠ¶æ€**: ğŸ”„ éœ€è¦æ”¹è¿›

### 3. è´¨é‡éªŒè¯è¿‡äºä¸¥æ ¼ (ä¸­ç­‰) - 8æ¬¡
**é—®é¢˜**: SSIMé˜ˆå€¼0.95è¿‡é«˜ï¼Œå¯¼è‡´è´¨é‡è‰¯å¥½çš„æ–‡ä»¶è¢«æ‹’ç»
**å½±å“**: æˆåŠŸç‡æä½ï¼Œå¤§é‡æ–‡ä»¶è¢«ä¿æŠ¤
**çŠ¶æ€**: ğŸ”„ éœ€è¦è°ƒæ•´

### 4. HEICå†…å­˜é™åˆ¶é”™è¯¯ (ä¸­ç­‰) - 2æ¬¡
**é—®é¢˜**: SecurityLimitExceeded - ipco boxè¶…è¿‡100ä¸ªé™åˆ¶
**å½±å“**: HEICæ–‡ä»¶æ— æ³•æ­£ç¡®åˆ†æ
**çŠ¶æ€**: ğŸ”„ éœ€è¦ä¿®å¤

### 5. å¿ƒè·³é‡å¤è­¦å‘Š (è½»å¾®) - 2æ¬¡
**é—®é¢˜**: x265 CLIç¼–ç æ—¶å‡ºç°é‡å¤å¿ƒè·³åç§°
**å½±å“**: æ—¥å¿—å™ªéŸ³ï¼Œä¸å½±å“åŠŸèƒ½
**çŠ¶æ€**: ğŸ”„ éœ€è¦ä¼˜åŒ–

### 6. å‹ç¼©å¤±è´¥ (è½»å¾®) - 2æ¬¡
**é—®é¢˜**: æŸäº›æ–‡ä»¶å³ä½¿åœ¨æœ€é«˜CRFä¸‹ä¹Ÿæ— æ³•å‹ç¼©
**å½±å“**: æ–‡ä»¶è¢«è·³è¿‡ï¼Œä½†è¿™æ˜¯æ­£å¸¸è¡Œä¸º
**çŠ¶æ€**: âœ… æ­£å¸¸è¡Œä¸º

## ğŸ› ï¸ ä¿®å¤è®¡åˆ’

### ä¼˜å…ˆçº§1: è´¨é‡é˜ˆå€¼è°ƒæ•´
```rust
// æ ¹æ®æ–‡ä»¶ç±»å‹å’Œå†…å®¹è°ƒæ•´SSIMé˜ˆå€¼
let quality_threshold = match file_type {
    FileType::Gif => 0.85,      // GIFé™ä½è¦æ±‚
    FileType::Jpeg => 0.90,     // JPEGé€‚ä¸­è¦æ±‚  
    FileType::Png => 0.95,      // PNGä¿æŒé«˜è¦æ±‚
    _ => 0.92,                  // å…¶ä»–æ ¼å¼é€‚ä¸­
};
```

### ä¼˜å…ˆçº§2: MS-SSIM Fallbackæ”¹è¿›
```rust
// æ”¹è¿›è´¨é‡è®¡ç®—fallbackæœºåˆ¶
if ms_ssim_failed && ssim_available {
    // ä½¿ç”¨SSIMä½œä¸ºä¸»è¦æŒ‡æ ‡
    use_ssim_only_with_adjusted_threshold();
} else if all_quality_failed {
    // ä½¿ç”¨æ–‡ä»¶å¤§å°å’ŒåŸºæœ¬æŒ‡æ ‡
    use_size_based_quality_check();
}
```

### ä¼˜å…ˆçº§3: HEICå†…å­˜é™åˆ¶ä¿®å¤
```rust
// å¢åŠ HEICè§£æçš„å†…å­˜é™åˆ¶
let heic_config = HeicConfig {
    max_child_boxes: 500,  // ä»100å¢åŠ åˆ°500
    memory_limit: 256_MB,  // å¢åŠ å†…å­˜é™åˆ¶
    fallback_to_basic: true,
};
```

### ä¼˜å…ˆçº§4: å¿ƒè·³ç®¡ç†ä¼˜åŒ–
```rust
// æ”¹è¿›å¿ƒè·³å‘½åæœºåˆ¶
let heartbeat_name = format!("{}_{}", process_type, unique_id);
// æˆ–è€…åœ¨å¯åŠ¨æ–°å¿ƒè·³å‰åœæ­¢åŒåå¿ƒè·³
```

## ğŸ“Š é¢„æœŸæ”¹è¿›æ•ˆæœ

ä¿®å¤åé¢„æœŸæˆåŠŸç‡æå‡ï¼š
- **å½“å‰æˆåŠŸç‡**: < 1% (22/2545)
- **ä¿®å¤åé¢„æœŸ**: 60-80% (1500-2000/2545)

ä¸»è¦æ”¹è¿›æ¥æºï¼š
1. è´¨é‡é˜ˆå€¼è°ƒæ•´: +50% æˆåŠŸç‡
2. MS-SSIM fallbackæ”¹è¿›: +15% æˆåŠŸç‡  
3. HEICä¿®å¤: +2% æˆåŠŸç‡
4. å…¶ä»–ä¼˜åŒ–: +3% æˆåŠŸç‡

## ğŸ”§ å®æ–½æ­¥éª¤

1. **ç«‹å³ä¿®å¤** (ä¼˜å…ˆçº§1-2)
   - è°ƒæ•´è´¨é‡é˜ˆå€¼
   - æ”¹è¿›MS-SSIM fallback

2. **åç»­ä¿®å¤** (ä¼˜å…ˆçº§3-4)  
   - HEICå†…å­˜é™åˆ¶
   - å¿ƒè·³ç®¡ç†ä¼˜åŒ–

3. **éªŒè¯æµ‹è¯•**
   - ä½¿ç”¨ç›¸åŒæµ‹è¯•æ•°æ®éªŒè¯ä¿®å¤æ•ˆæœ
   - ç¡®ä¿æˆåŠŸç‡æ˜¾è‘—æå‡

## ğŸ“ ä¿®å¤è®°å½•

- âœ… v7.8: GIFåƒç´ æ ¼å¼æ£€æµ‹å·²ä¿®å¤
- âœ… v7.8: 1%å®¹å·®æœºåˆ¶å·²å®æ–½
- ğŸ”„ v7.8.1: è´¨é‡é˜ˆå€¼è°ƒæ•´ (è®¡åˆ’ä¸­)
- ğŸ”„ v7.8.1: MS-SSIM fallbackæ”¹è¿› (è®¡åˆ’ä¸­)
- ğŸ”„ v7.8.2: HEICå’Œå¿ƒè·³ä¼˜åŒ– (è®¡åˆ’ä¸­)