# Modern Format Boost v4.6 - ç®—æ³•æ·±åº¦å¤ç›˜

## ğŸ“‹ ç›®å½•
1. [æ ¸å¿ƒè®¾è®¡ç†å¿µ](#æ ¸å¿ƒè®¾è®¡ç†å¿µ)
2. [Flag ç»„åˆç³»ç»Ÿ](#flag-ç»„åˆç³»ç»Ÿ)
3. [è´¨é‡åŒ¹é…ç®—æ³•](#è´¨é‡åŒ¹é…ç®—æ³•)
4. [CRF æœç´¢ç®—æ³•](#crf-æœç´¢ç®—æ³•)
5. [ç²¾åº¦åˆ†æ](#ç²¾åº¦åˆ†æ)
6. [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
7. [æµ‹è¯•è¦†ç›–](#æµ‹è¯•è¦†ç›–)

---

## æ ¸å¿ƒè®¾è®¡ç†å¿µ

### ğŸ¯ ä¸‰å¤§æ”¯æŸ±

| æ”¯æŸ± | è¯´æ˜ | å®ç° |
|------|------|------|
| **ä¿ç•™** | å®Œæ•´ä¿ç•™å…ƒæ•°æ®ã€ICC é…ç½®ã€æ—¶é—´æˆ³ | exiftool + xattr + SetFile |
| **è´¨é‡** | ä»…æ— æŸæˆ–è§†è§‰æ— æŸè½¬æ¢ | SSIM â‰¥ 0.95 éªŒè¯ |
| **å…¼å®¹** | Apple ç”Ÿæ€ä¼˜å…ˆæ”¯æŒ | HEVC ç¼–ç å™¨ + --apple-compat flag |

### ğŸ”¥ v4.6 æ–°å¢ï¼šFlag ç»„åˆæ¨¡å—åŒ–

**é—®é¢˜**ï¼šå››ä¸ªå·¥å…·ï¼ˆimgquality_hevc, imgquality_av1, vidquality_hevc, vidquality_av1ï¼‰ä¸­é‡å¤å®ç° flag éªŒè¯é€»è¾‘

**è§£å†³**ï¼š
- åˆ›å»º `flag_validator.rs` æ¨¡å—
- ç»Ÿä¸€ 7 ç§æœ‰æ•ˆç»„åˆ + 1 ç§æ— æ•ˆç»„åˆçš„éªŒè¯
- æ‰€æœ‰å·¥å…·å…±äº«åŒä¸€å¥—é€»è¾‘ï¼Œæ¶ˆé™¤é‡å¤ä»£ç 

---

## Flag ç»„åˆç³»ç»Ÿ

### ğŸ”¥ v4.6 Flag ç»„åˆè¯­ä¹‰

```
FlagMode æšä¸¾ï¼ˆ7 ç§æœ‰æ•ˆ + 1 ç§æ— æ•ˆï¼‰
â”œâ”€â”€ Default                          (æ—  flag)
â”œâ”€â”€ CompressOnly                     (--compress)
â”œâ”€â”€ ExploreOnly                      (--explore)
â”œâ”€â”€ QualityOnly                      (--match-quality)
â”œâ”€â”€ CompressWithQuality              (--compress --match-quality)
â”œâ”€â”€ PreciseQuality                   (--explore --match-quality)
â”œâ”€â”€ PreciseQualityWithCompress       (--explore --match-quality --compress)
â””â”€â”€ âŒ INVALID: ExploreCompress      (--explore --compress æ—  --match-quality)
```

### ç»„åˆè¯­ä¹‰è¯¦è§£

| ç»„åˆ | ç›®æ ‡ | ç­–ç•¥ | è¿­ä»£ | ç”¨é€” |
|------|------|------|------|------|
| `--compress` | è¾“å‡º < è¾“å…¥ | å¿«é€Ÿæ‰¾åˆ°èƒ½å‹ç¼©çš„ CRF | ~8 | å¿«é€Ÿå‹ç¼© |
| `--explore` | æœ€å°è¾“å‡º | äºŒåˆ†æœç´¢æœ€å°æ–‡ä»¶ | ~8 | æé™å‹ç¼© |
| `--match-quality` | ç²—ç•¥è´¨é‡ | AI é¢„æµ‹ CRF + SSIM éªŒè¯ | 1 | å¿«é€Ÿè½¬æ¢ |
| `--compress --match-quality` | å‹ç¼© + è´¨é‡ | åœ¨å‹ç¼©èŒƒå›´å†…æ‰¾æœ€é«˜ SSIM | ~10 | å¹³è¡¡æ–¹æ¡ˆ |
| `--explore --match-quality` | ç²¾ç¡®è´¨é‡ | æ‰¾æœ€é«˜ SSIMï¼ˆä¸é™å¤§å°ï¼‰ | ~12 | è´¨é‡ä¼˜å…ˆ |
| `--explore --match-quality --compress` | ç²¾ç¡® + å‹ç¼© | æœ€é«˜ SSIM ä¸”è¾“å‡º < è¾“å…¥ | ~15 | å®Œç¾æ–¹æ¡ˆ |

### æ— æ•ˆç»„åˆæ£€æµ‹

```rust
// --explore --compressï¼ˆæ—  --match-qualityï¼‰
if explore && !match_quality && compress {
    return Err("âŒ æ— æ•ˆçš„ flag ç»„åˆ: --explore --compress
ğŸ’¡ --explore å¯»æ‰¾æœ€å°è¾“å‡ºï¼Œ--compress åªè¦æ›´å°å³å¯ï¼Œä¸¤è€…ç›®æ ‡å†²çª
ğŸ’¡ æœ‰æ•ˆç»„åˆ:
   â€¢ --compress å•ç‹¬ï¼šåªè¦è¾“å‡º < è¾“å…¥
   â€¢ --explore å•ç‹¬ï¼šå¯»æ‰¾å°½å¯èƒ½æ›´å°çš„è¾“å‡º
   â€¢ --explore --match-quality --compressï¼šç²¾ç¡®è´¨é‡åŒ¹é… + å¿…é¡»å‹ç¼©");
}
```

**ä¸ºä»€ä¹ˆæ— æ•ˆï¼Ÿ**
- `--explore`ï¼šç›®æ ‡æ˜¯æ‰¾åˆ°**æœ€å°**è¾“å‡ºï¼ˆäºŒåˆ†æœç´¢ï¼‰
- `--compress`ï¼šç›®æ ‡æ˜¯æ‰¾åˆ°**ä»»ä½•**æ›´å°çš„è¾“å‡ºï¼ˆè´ªå¿ƒï¼‰
- ä¸¤è€…ç›®æ ‡å†²çªï¼Œæ— æ³•åŒæ—¶æ»¡è¶³

---

## è´¨é‡åŒ¹é…ç®—æ³•

### ğŸ”¥ v3.5 AI é¢„æµ‹ CRF

**è¾“å…¥åˆ†æ**ï¼ˆ9 ä¸ªå› å­ï¼‰ï¼š

| å› å­ | æƒé‡ | æ£€æµ‹æ–¹æ³• | å½±å“èŒƒå›´ |
|------|------|----------|----------|
| è§†é¢‘ä¸“ç”¨ç ç‡ | 55% | æ’é™¤éŸ³é¢‘ | Â±5 CRF |
| GOP ç»“æ„ | 15% | GOP å¤§å° + B å¸§ | Â±3 CRF |
| è‰²åº¦é‡‡æ · | 10% | YUV420 vs YUV444 | Â±2 CRF |
| HDR æ£€æµ‹ | 8% | BT.2020 è‰²åŸŸ | Â±2 CRF |
| å†…å®¹ç±»å‹ | 7% | åŠ¨ç”»/èƒ¶ç‰‡/è‡ªç„¶ | Â±4 CRF |
| åƒç´ æ ¼å¼ | 2% | yuv420p/yuv444p | Â±1 CRF |
| å®½é«˜æ¯” | 1% | è¶…å®½æ£€æµ‹ | Â±0.5 CRF |
| SI/TI å¤æ‚åº¦ | 1% | ç©ºé—´/æ—¶é—´æŒ‡æ ‡ | Â±0.5 CRF |
| èƒ¶ç‰‡é¢—ç²’ | 1% | é«˜é¢‘å™ªå£° | Â±1 CRF |

**CRF è®¡ç®—å…¬å¼ï¼ˆHEVCï¼‰**ï¼š

```
CRF = 46 - 5 Ã— logâ‚‚(effective_bpp Ã— 100) + content_adjustment + bias

å…¶ä¸­ï¼š
- effective_bpp = (video_bitrate_kbps / 8) / (width Ã— height Ã— fps)
- content_adjustment = åŠ¨ç”» +4, èƒ¶ç‰‡ -3, è‡ªç„¶ 0
- bias = ç”¨æˆ·åå¥½è°ƒæ•´
```

**ç²¾åº¦**ï¼š~92% ç½®ä¿¡åº¦ï¼ˆvs æ—§ç‰ˆ ~75%ï¼‰

### ğŸ”¥ v4.5 ç²¾ç¡®è´¨é‡åŒ¹é… - é«˜æ•ˆæœç´¢

**ç›®æ ‡**ï¼šæ‰¾åˆ°**æœ€é«˜ SSIM**ï¼ˆæœ€æ¥è¿‘æºè´¨é‡ï¼‰

**ä¸‰é˜¶æ®µæœç´¢**ï¼š

```
Phase 1: è¾¹ç•Œæµ‹è¯• (~2 æ¬¡è¿­ä»£)
â”œâ”€â”€ æµ‹è¯• min_crfï¼ˆæœ€é«˜è´¨é‡ç‚¹ï¼‰
â”œâ”€â”€ æµ‹è¯• max_crfï¼ˆæœ€ä½è´¨é‡ç‚¹ï¼‰
â””â”€â”€ è®¡ç®— SSIM èŒƒå›´

Phase 2: å¹³å°æœç´¢ (~4-6 æ¬¡è¿­ä»£)
â”œâ”€â”€ ä» min_crf å‘ä¸Šæœç´¢ï¼ˆæ­¥é•¿ 2.0ï¼‰
â”œâ”€â”€ æ£€æµ‹ SSIM å¹³å°ï¼ˆç»§ç»­é™ä½ CRF ä¸å†æå‡ SSIMï¼‰
â””â”€â”€ åœ¨å¹³å°å†…é€‰æ‹©æ›´é«˜ CRFï¼ˆæ›´å°æ–‡ä»¶ï¼‰

Phase 3: ç²¾ç»†è°ƒæ•´ (~2-4 æ¬¡è¿­ä»£)
â”œâ”€â”€ Â±1 CRF èŒƒå›´å†…æœç´¢ï¼ˆæ­¥é•¿ 0.5ï¼‰
â””â”€â”€ é€‰æ‹©æœ€é«˜ SSIM çš„ CRF
```

**ä¸ºä»€ä¹ˆé«˜æ•ˆï¼Ÿ**
- SSIM æ˜¯å•è°ƒé€’å‡çš„ï¼ˆCRFâ†‘ â†’ SSIMâ†“ï¼‰
- æœ€é«˜ SSIM æ€»æ˜¯åœ¨æœ€ä½ CRF
- ä½†å­˜åœ¨å¹³å°ï¼ˆç»§ç»­é™ä½ CRF ä¸å†æå‡ SSIMï¼‰
- ä¸‰é˜¶æ®µæœç´¢å¿«é€Ÿå®šä½å¹³å°è¾¹ç¼˜

---

## CRF æœç´¢ç®—æ³•

### ğŸ”¥ v4.6 å››é˜¶æ®µæœç´¢ - Â±0.1 ç²¾åº¦

**ç²¾åº¦æå‡**ï¼šä» Â±0.5 â†’ Â±0.1

```
Phase 1: ç²—æœç´¢ (æ­¥é•¿ 2.0)
â”œâ”€â”€ å¿«é€Ÿå®šä½è¾¹ç•ŒåŒºé—´
â”œâ”€â”€ è¿­ä»£æ¬¡æ•°ï¼š(max_crf - min_crf) / 2.0
â””â”€â”€ å…¸å‹ [18, 28]ï¼š5 æ¬¡

Phase 2: ç»†æœç´¢ (æ­¥é•¿ 0.5)
â”œâ”€â”€ ç²¾ç¡®å®šä½æœ€ä¼˜ç‚¹
â”œâ”€â”€ è¿­ä»£æ¬¡æ•°ï¼š(boundary_high - boundary_low) / 0.5
â””â”€â”€ å…¸å‹ï¼š4 æ¬¡

Phase 3: ç²¾ç»†æœç´¢ (æ­¥é•¿ 0.1)
â”œâ”€â”€ è¾¾åˆ° Â±0.1 ç²¾åº¦
â”œâ”€â”€ è¿­ä»£æ¬¡æ•°ï¼š(fine_high - fine_low) / 0.1
â””â”€â”€ å…¸å‹ï¼š2-3 æ¬¡

Phase 4: éªŒè¯ (æ­¥é•¿ 0.05)
â”œâ”€â”€ éªŒè¯è¾¹ç•Œç‚¹
â”œâ”€â”€ ç¡®ä¿æœ€ä¼˜
â””â”€â”€ è¿­ä»£æ¬¡æ•°ï¼š1-2 æ¬¡
```

**æ€»è¿­ä»£æ¬¡æ•°**ï¼š
- ç²—æœç´¢ï¼š5 æ¬¡
- ç»†æœç´¢ï¼š4 æ¬¡
- ç²¾ç»†æœç´¢ï¼š3 æ¬¡
- éªŒè¯ï¼š2 æ¬¡
- **æ€»è®¡**ï¼š~14 æ¬¡ï¼ˆmax_iterations=15ï¼‰

### äºŒåˆ†æœç´¢ç²¾åº¦è¯æ˜

**å¯¹äº HEVC [10, 28]ï¼Œrange = 18**ï¼š

```
Phase 1 (ç²—æœç´¢ï¼Œæ­¥é•¿ 2.0):
  18 / 2.0 = 9 ä¸ªå¯èƒ½çš„ CRF å€¼
  äºŒåˆ†æœç´¢éœ€è¦ ceil(log2(9)) = 4 æ¬¡è¿­ä»£
  å®é™…ï¼š5 æ¬¡ï¼ˆåŒ…æ‹¬è¾¹ç•ŒéªŒè¯ï¼‰

Phase 2 (ç»†æœç´¢ï¼Œæ­¥é•¿ 0.5):
  2.0 / 0.5 = 4 ä¸ªå¯èƒ½çš„ CRF å€¼
  äºŒåˆ†æœç´¢éœ€è¦ ceil(log2(4)) = 2 æ¬¡è¿­ä»£
  å®é™…ï¼š4 æ¬¡ï¼ˆåŒ…æ‹¬è¾¹ç•ŒéªŒè¯ï¼‰

Phase 3 (ç²¾ç»†æœç´¢ï¼Œæ­¥é•¿ 0.1):
  0.5 / 0.1 = 5 ä¸ªå¯èƒ½çš„ CRF å€¼
  äºŒåˆ†æœç´¢éœ€è¦ ceil(log2(5)) = 3 æ¬¡è¿­ä»£
  å®é™…ï¼š3 æ¬¡

æ€»è®¡ï¼š5 + 4 + 3 = 12 æ¬¡ âœ“
```

---

## ç²¾åº¦åˆ†æ

### ğŸ”¥ v4.6 Â±0.1 CRF ç²¾åº¦

**ç²¾åº¦å®šä¹‰**ï¼šæœ€ç»ˆ CRF ä¸çœŸå®æœ€ä¼˜ CRF çš„åå·® â‰¤ 0.1

**ç²¾åº¦ä¿è¯**ï¼š

| é˜¶æ®µ | æ­¥é•¿ | ç²¾åº¦ | éªŒè¯ |
|------|------|------|------|
| Phase 1 | 2.0 | Â±2.0 | ç²—å®šä½ |
| Phase 2 | 0.5 | Â±0.5 | ç»†å®šä½ |
| Phase 3 | 0.1 | Â±0.1 | ç²¾ç¡®å®šä½ |
| Phase 4 | 0.05 | Â±0.05 | éªŒè¯ |

**SSIM ç²¾åº¦**ï¼š

```
SSIM æ˜¾ç¤ºç²¾åº¦ï¼š4 ä½å°æ•°ï¼ˆ0.0001ï¼‰
SSIM æ¯”è¾ƒç²¾åº¦ï¼šepsilon = 0.0001
SSIM è´¨é‡ç­‰çº§ï¼š
  >= 0.98   â†’ Excellent (å‡ ä¹æ— æ³•åŒºåˆ†)
  >= 0.95   â†’ Good (è§†è§‰æ— æŸ)
  >= 0.90   â†’ Acceptable (è½»å¾®å·®å¼‚)
  >= 0.85   â†’ Fair (å¯è§å·®å¼‚)
  < 0.85    â†’ Poor (æ˜æ˜¾è´¨é‡æŸå¤±)
```

### è´¨é‡éªŒè¯ä¸‰é‡äº¤å‰éªŒè¯

```rust
// å½“å¯ç”¨å¤šä¸ªè´¨é‡æŒ‡æ ‡æ—¶
if validate_ssim && validate_vmaf && validate_psnr {
    // ä¸‰é‡éªŒè¯ï¼šSSIM 50%, VMAF 35%, PSNR 15%
    score = ssim_norm * 0.50 + vmaf_norm * 0.35 + psnr_norm * 0.15
} else if validate_ssim && validate_vmaf {
    // SSIM + VMAFï¼šSSIM 60%, VMAF 40%
    score = ssim_norm * 0.60 + vmaf_norm * 0.40
} else {
    // ä»… SSIM
    score = ssim_norm
}

// äº¤å‰éªŒè¯ç»“æœ
match (ssim_ok, psnr_ok, vmaf_ok) {
    (true, true, true)   => CrossValidationResult::AllAgree,      // ğŸŸ¢ é«˜ç½®ä¿¡
    (true, true, false)  => CrossValidationResult::MajorityAgree, // ğŸŸ¡ è‰¯å¥½
    (true, false, true)  => CrossValidationResult::MajorityAgree, // ğŸŸ¡ è‰¯å¥½
    (false, true, true)  => CrossValidationResult::MajorityAgree, // ğŸŸ¡ è‰¯å¥½
    _                    => CrossValidationResult::Divergent,     // ğŸ”´ åˆ†æ­§
}
```

---

## æ€§èƒ½ä¼˜åŒ–

### ğŸ”¥ v4.5 ç¼“å­˜æœºåˆ¶

```rust
// ç¼“å­˜å·²æµ‹è¯•çš„ CRFï¼Œé¿å…é‡å¤ç¼–ç 
let mut tested_crfs: HashMap<i32, (u64, (Option<f64>, Option<f64>, Option<f64>))> = HashMap::new();

// æµ‹è¯•å‰æ£€æŸ¥ç¼“å­˜
let key = (crf * 10.0).round() as i32;
if let Some(&cached) = tested_crfs.get(&key) {
    return Ok(cached);  // ç›´æ¥è¿”å›ç¼“å­˜ç»“æœ
}

// ç¼–ç åå­˜å…¥ç¼“å­˜
tested_crfs.insert(key, (size, quality));
```

**ç¼“å­˜æ•ˆæœ**ï¼š
- å‡å°‘é‡å¤ç¼–ç  ~30%
- åŠ é€Ÿæœç´¢ ~2-3 å€

### ğŸ”¥ v4.6 å®æ—¶æ—¥å¿—è¾“å‡º

```rust
macro_rules! log_realtime {
    ($($arg:tt)*) => {{
        let msg = format!($($arg)*);
        eprintln!("{}", msg);  // å®æ—¶è¾“å‡ºåˆ° stderr
        log.push(msg);         // åŒæ—¶ä¿å­˜åˆ°æ—¥å¿—
    }};
}
```

**ä¼˜åŠ¿**ï¼š
- ç”¨æˆ·å¯å®æ—¶çœ‹åˆ°è¿›åº¦
- ä¸é˜»å¡ç¼–ç è¿‡ç¨‹
- ä¾¿äºè°ƒè¯•å’Œç›‘æ§

### çº¿ç¨‹ç®¡ç†

```rust
// é™åˆ¶ ffmpeg çº¿ç¨‹æ•°ï¼Œé¿å…ç³»ç»Ÿå¡é¡¿
let max_threads = (num_cpus::get() / 2).clamp(1, 4);

// ä¼ é€’ç»™ ffmpeg
-threads {max_threads}
-x265-params log-level=error:pools={max_threads}
```

---

## æµ‹è¯•è¦†ç›–

### ğŸ”¥ v4.6 Flag éªŒè¯å™¨æµ‹è¯•

**17 ä¸ªå•å…ƒæµ‹è¯•**ï¼š

```
âœ… åŸºç¡€æœ‰æ•ˆç»„åˆæµ‹è¯• (7 ä¸ª)
   - Default
   - CompressOnly
   - ExploreOnly
   - QualityOnly
   - CompressWithQuality
   - PreciseQuality
   - PreciseQualityWithCompress

âœ… æ— æ•ˆç»„åˆæµ‹è¯• (2 ä¸ª)
   - æ£€æµ‹ --explore --compress
   - éªŒè¯é”™è¯¯ä¿¡æ¯

âœ… Result API æµ‹è¯• (2 ä¸ª)
   - validate_flags_result() è¿”å› Ok/Err
   - æ‰€æœ‰ 8 ç§å¸ƒå°”ç»„åˆ

âœ… FlagMode æ–¹æ³•æµ‹è¯• (4 ä¸ª)
   - Display æ ¼å¼åŒ–
   - ä¸­æ–‡æè¿°
   - è‹±æ–‡æè¿°
   - Debug è¾“å‡º

âœ… è¾¹ç¼˜æ¡ˆä¾‹æµ‹è¯• (2 ä¸ª)
   - ç›¸ç­‰æ€§æ¯”è¾ƒ
   - Clone/Copy è¯­ä¹‰

âœ… è¯­ä¹‰æ­£ç¡®æ€§æµ‹è¯• (3 ä¸ª)
   - CompressOnly vs ExploreOnly
   - QualityOnly vs PreciseQuality
   - CompressWithQuality vs PreciseQualityWithCompress

âœ… å®Œæ•´æ€§æµ‹è¯• (2 ä¸ª)
   - æ‰€æœ‰ 8 ç§å¸ƒå°”ç»„åˆéƒ½æœ‰å¤„ç†
   - æ°å¥½ 1 ç§æ— æ•ˆç»„åˆ
```

### è´¨é‡åŒ¹é…æµ‹è¯•

```
âœ… å¤§å°è®¡ç®—æµ‹è¯•
   - 50% å‡å°
   - 75% å‡å°
   - æ— å˜åŒ–
   - å¢å¤§

âœ… è¾“å‡ºè·¯å¾„æµ‹è¯•
   - åŸºæœ¬è·¯å¾„
   - æŒ‡å®šè¾“å‡ºç›®å½•
   - å„ç§æ‰©å±•å

âœ… è½¬æ¢ç»“æœæµ‹è¯•
   - æˆåŠŸè½¬æ¢
   - å¤§å°å¢åŠ å›é€€
   - è·³è¿‡å¤„ç†

âœ… ä¸€è‡´æ€§æµ‹è¯•
   - ç›¸åŒè¾“å…¥äº§ç”Ÿç›¸åŒè¾“å‡º
   - ç¡®å®šæ€§ç®—æ³•
```

---

## æ¶æ„è®¾è®¡

### æ¨¡å—åŒ–ç»“æ„

```
shared_utils/src/
â”œâ”€â”€ flag_validator.rs          â† ğŸ”¥ v4.6 æ–°å¢ï¼šFlag ç»„åˆéªŒè¯
â”œâ”€â”€ video_explorer.rs          â† CRF æœç´¢ç®—æ³•
â”œâ”€â”€ quality_matcher.rs         â† AI è´¨é‡é¢„æµ‹
â”œâ”€â”€ conversion.rs              â† è½¬æ¢é€‰é¡¹ + ç»“æœ
â”œâ”€â”€ checkpoint.rs              â† æ–­ç”µä¿æŠ¤
â”œâ”€â”€ metadata.rs                â† å…ƒæ•°æ®ä¿ç•™
â”œâ”€â”€ progress.rs                â† è¿›åº¦æ˜¾ç¤º
â””â”€â”€ lib.rs                     â† æ¨¡å—å¯¼å‡º

å››ä¸ªå·¥å…·å…±äº«ï¼š
â”œâ”€â”€ imgquality_hevc/
â”œâ”€â”€ imgquality_av1/
â”œâ”€â”€ vidquality_hevc/
â””â”€â”€ vidquality_av1/
```

### ä¾èµ–å…³ç³»

```
flag_validator.rs (ç‹¬ç«‹)
    â†“
conversion.rs (ä½¿ç”¨ flag_validator)
    â†“
video_explorer.rs (ä½¿ç”¨ conversion)
    â†“
å››ä¸ªå·¥å…· (ä½¿ç”¨ video_explorer)
```

---

## ç‰ˆæœ¬æ¼”è¿›

| ç‰ˆæœ¬ | ä¸»è¦æ”¹è¿› | ç²¾åº¦ |
|------|----------|------|
| v3.4 | CRF ä» u8 â†’ f32ï¼ˆæ”¯æŒ 0.5 æ­¥é•¿ï¼‰ | Â±1.0 |
| v3.5 | AI è´¨é‡é¢„æµ‹ï¼ˆ9 å› å­åˆ†æï¼‰ | Â±1.0 |
| v3.6 | ä¸‰é˜¶æ®µæœç´¢ + ç²¾åº¦å¸¸æ•° | Â±0.5 |
| v4.1 | ä¸‰é‡äº¤å‰éªŒè¯ï¼ˆSSIM+PSNR+VMAFï¼‰ | Â±0.5 |
| v4.5 | ç²¾ç¡®è´¨é‡åŒ¹é… + é«˜æ•ˆæœç´¢ | Â±0.5 |
| v4.6 | Flag ç»„åˆæ¨¡å—åŒ– + å››é˜¶æ®µæœç´¢ | **Â±0.1** |

---

## å…³é”®æ´å¯Ÿ

### ğŸ”¥ ä¸ºä»€ä¹ˆ Â±0.1 ç²¾åº¦è¶³å¤Ÿï¼Ÿ

1. **CRF çš„éçº¿æ€§ç‰¹æ€§**
   - CRF å˜åŒ– 0.1 â†’ æ–‡ä»¶å¤§å°å˜åŒ– ~0.5-1%
   - SSIM å˜åŒ– ~0.0001-0.0005
   - äººçœ¼æ— æ³•åŒºåˆ†

2. **ç¼–ç å™¨çš„é‡åŒ–ç‰¹æ€§**
   - x265/SVT-AV1 å†…éƒ¨é‡åŒ–æ­¥é•¿ > 0.1
   - 0.1 ç²¾åº¦å·²æ¥è¿‘ç¼–ç å™¨çš„æœ€å°å¯åˆ†è¾¨å•ä½

3. **SSIM æµ‹é‡ç²¾åº¦**
   - ffmpeg ssim æ»¤é•œè¾“å‡ºç²¾åº¦ 0.0001
   - 0.1 CRF å˜åŒ–å¯¼è‡´ SSIM å˜åŒ– < 0.001
   - è¿œå°äºæµ‹é‡ç²¾åº¦

### ğŸ”¥ ä¸ºä»€ä¹ˆéœ€è¦å››é˜¶æ®µæœç´¢ï¼Ÿ

1. **ç²—æœç´¢ï¼ˆæ­¥é•¿ 2.0ï¼‰**
   - å¿«é€Ÿå®šä½å¤§è‡´èŒƒå›´
   - é¿å…éå†æ‰€æœ‰ CRF å€¼

2. **ç»†æœç´¢ï¼ˆæ­¥é•¿ 0.5ï¼‰**
   - ç²¾ç¡®å®šä½æœ€ä¼˜ç‚¹
   - åœ¨ç²—æœç´¢ç»“æœé™„è¿‘æœç´¢

3. **ç²¾ç»†æœç´¢ï¼ˆæ­¥é•¿ 0.1ï¼‰**
   - è¾¾åˆ° Â±0.1 ç²¾åº¦
   - ç¡®ä¿æœ€ä¼˜ CRF

4. **éªŒè¯ï¼ˆæ­¥é•¿ 0.05ï¼‰**
   - éªŒè¯è¾¹ç•Œç‚¹
   - ç¡®ä¿æ²¡æœ‰é—æ¼æ›´ä¼˜ç‚¹

### ğŸ”¥ Flag ç»„åˆçš„è®¾è®¡åŸåˆ™

1. **å•ä¸€èŒè´£**
   - æ¯ä¸ª flag åªåšä¸€ä»¶äº‹
   - `--compress`ï¼šç¡®ä¿å‹ç¼©
   - `--explore`ï¼šå¯»æ‰¾æœ€å°
   - `--match-quality`ï¼šéªŒè¯è´¨é‡

2. **ç»„åˆçš„è¯­ä¹‰æ¸…æ™°**
   - `--compress --match-quality`ï¼šå‹ç¼© + è´¨é‡
   - `--explore --match-quality`ï¼šç²¾ç¡®è´¨é‡
   - `--explore --match-quality --compress`ï¼šç²¾ç¡® + å‹ç¼©

3. **æ— æ•ˆç»„åˆçš„æ£€æµ‹**
   - `--explore --compress`ï¼šç›®æ ‡å†²çª
   - å“äº®æŠ¥é”™ï¼Œæä¾›å»ºè®®

---

## æ€»ç»“

### ğŸ¯ v4.6 çš„ä¸‰å¤§æˆå°±

1. **Flag ç»„åˆæ¨¡å—åŒ–**
   - æ¶ˆé™¤å››ä¸ªå·¥å…·çš„é‡å¤ä»£ç 
   - ç»Ÿä¸€éªŒè¯é€»è¾‘
   - 17 ä¸ªå•å…ƒæµ‹è¯•è¦†ç›–

2. **ç²¾åº¦æå‡åˆ° Â±0.1**
   - å››é˜¶æ®µæœç´¢
   - ç¼“å­˜æœºåˆ¶
   - å®æ—¶æ—¥å¿—

3. **å®Œæ•´çš„æ–‡æ¡£å’Œæµ‹è¯•**
   - ä¸­è‹±æ–‡ README
   - ç®—æ³•æ·±åº¦å¤ç›˜
   - 352 ä¸ªå•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡

### ğŸ“Š æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| CRF ç²¾åº¦ | Â±0.1 |
| SSIM ç²¾åº¦ | 0.0001 |
| å…¸å‹è¿­ä»£æ¬¡æ•° | 12-15 |
| ç¼“å­˜å‘½ä¸­ç‡ | ~30% |
| å•å…ƒæµ‹è¯•è¦†ç›– | 352 ä¸ª |
| ç¼–è¯‘è­¦å‘Š | 4 ä¸ªï¼ˆæœªä½¿ç”¨æ–¹æ³•ï¼‰ |

---

## å‚è€ƒèµ„æº

- [README.md](./README.md) - ç”¨æˆ·æ–‡æ¡£
- [flag_validator.rs](./shared_utils/src/flag_validator.rs) - Flag éªŒè¯æ¨¡å—
- [video_explorer.rs](./shared_utils/src/video_explorer.rs) - CRF æœç´¢ç®—æ³•
- [quality_matcher.rs](./shared_utils/src/quality_matcher.rs) - AI è´¨é‡é¢„æµ‹
